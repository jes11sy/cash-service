generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Cash transactions
model Cash {
  id             Int      @id @default(autoincrement())
  name           String   // "–ø—Ä–∏—Ö–æ–¥" –∏–ª–∏ "—Ä–∞—Å—Ö–æ–¥"
  amount         Decimal  @db.Decimal(10, 2)
  city           String?  @default("–ú–æ—Å–∫–≤–∞")
  note           String?
  receiptDoc     String?  @map("receipt_doc")
  paymentPurpose String?  @unique @map("payment_purpose") // –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ - —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
  dateCreate     DateTime @default(now()) @map("date_create")
  nameCreate     String   @map("name_create")
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")

  // üöÄ –ò–Ω–¥–µ–∫—Å—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
  @@index([name, city]) // –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∏–Ω–¥–µ–∫—Å
  @@index([nameCreate, dateCreate(sort: Desc)]) // –î–ª—è –ø–æ–∏—Å–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  @@index([city, dateCreate(sort: Desc)]) // –î–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –≥–æ—Ä–æ–¥—É —Å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π
  @@index([dateCreate(sort: Desc)]) // –î–ª—è –æ–±—â–µ–π —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ –¥–∞—Ç–µ
  @@index([name, dateCreate(sort: Desc)]) // –î–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ —Ç–∏–ø—É —Å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π
  @@map("cash")
}

model Master {
  id           Int      @id @default(autoincrement())
  cities       String[]
  name         String
  login        String?  @unique
  password     String?
  passportDoc  String?  @map("passport_doc")
  contractDoc  String?  @map("contract_doc")
  statusWork   String   @map("status_work")
  dateCreate   DateTime @default(now()) @map("date_create")
  note         String?
  tgId         String?  @map("tg_id")
  chatId       String?  @map("chat_id")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")
  orders       Order[]

  @@map("master")
}

model Order {
  id                    Int                @id @default(autoincrement())
  rk                    String             @map("rk")
  city                  String
  avitoName             String?            @map("avito_name")
  phone                 String
  typeOrder             String             @map("type_order")
  clientName            String             @map("client_name")
  address               String
  dateMeeting           DateTime           @map("date_meeting")
  typeEquipment         String             @map("type_equipment")
  problem               String
  callRecord            String?            @map("call_record")
  statusOrder           String             @map("status_order")
  masterId              Int?               @map("master_id")
  result                Decimal?           @db.Decimal(10, 2)
  expenditure           Decimal?           @db.Decimal(10, 2)
  clean                 Decimal?           @db.Decimal(10, 2)
  masterChange          Decimal?           @map("master_change") @db.Decimal(10, 2)
  bsoDoc                String[]           @default([]) @map("bso_doc")
  expenditureDoc        String[]           @default([]) @map("expenditure_doc")
  operatorNameId        Int                @map("operator_name_id")
  createDate            DateTime           @map("create_date")
  closingData           DateTime?          @map("closing_data")
  createdAt             DateTime           @default(now()) @map("created_at")
  updatedAt             DateTime           @updatedAt @map("updated_at")
  avitoChatId           String?            @map("avito_chatid")
  callId                String?            @map("call_id")
  prepayment            Decimal?           @db.Decimal(10, 2)
  dateClosmod           DateTime?          @map("date_closmod")
  comment               String?
  cashSubmissionStatus  String?            @default("–ì–æ—Ç–æ–≤–æ") @map("cash_submission_status")
  cashSubmissionDate    DateTime?          @map("cash_submission_date")
  cashSubmissionAmount  Decimal?           @map("cash_submission_amount") @db.Decimal(10, 2)
  cashReceiptDoc        String?            @map("cash_receipt_doc")
  cashApprovedBy        Int?               @map("cash_approved_by")
  cashApprovedDate      DateTime?          @map("cash_approved_date")
  master                Master?            @relation(fields: [masterId], references: [id])

  // üöÄ –ò–Ω–¥–µ–∫—Å—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–ª—è handover
  @@index([masterId, statusOrder]) // –î–ª—è –ø–æ–∏—Å–∫–∞ –∑–∞–∫–∞–∑–æ–≤ –º–∞—Å—Ç–µ—Ä–∞ –ø–æ —Å—Ç–∞—Ç—É—Å—É
  @@index([masterId, cashSubmissionStatus]) // –î–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Å–¥–∞—á –º–∞—Å—Ç–µ—Ä–∞
  @@index([closingData(sort: Desc)]) // –î–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ –¥–∞—Ç–µ –∑–∞–∫—Ä—ã—Ç–∏—è
  @@index([masterId, statusOrder, cashSubmissionStatus]) // –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–Ω–¥–µ–∫—Å –¥–ª—è handover
  @@index([statusOrder, closingData(sort: Desc)]) // –î–ª—è –∞–¥–º–∏–Ω–æ–≤
  @@map("orders")
}

model AuditLog {
  id        Int      @id @default(autoincrement())
  timestamp DateTime @default(now())
  eventType String   @db.VarChar(100)
  userId    Int?
  role      String?  @db.VarChar(50)
  login     String?  @db.VarChar(255)
  ip        String   @db.VarChar(45)
  userAgent String   @db.Text
  success   Boolean
  metadata  Json?    @db.JsonB

  @@index([userId, timestamp(sort: Desc)])
  @@index([eventType, timestamp(sort: Desc)])
  @@index([timestamp(sort: Desc)])
  @@map("audit_logs")
}





